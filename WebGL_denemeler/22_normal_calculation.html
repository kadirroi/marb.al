<html>

	<body>

		<script type="text/javascript" src="glmatrix_lib/dist/gl-matrix.js"></script>

		<script type="text/javascript">

			function calculateVertexNormals(vertices, indices){
				
				var vertexVectors = [];
				var normalVectors = [];
				var normals = [];

				for (var i=0; i<vertices.length; i+=3){	
					var vector = vec3.fromValues(vertices[i], vertices[i+1], vertices[i+2]);
					var normal = vec3.create();
					normalVectors.push(normal);
					vertexVectors.push(vector);
				}
				
				for (var j=0; j<indices.length; j+=3){
					var vector1 = vec3.create();
					vec3.subtract(vector1, vertexVectors[indices[j+1]], vertexVectors[indices[j]]);
					var vector2 = vec3.create();
					vec3.subtract(vector2, vertexVectors[indices[j+2]], vertexVectors[indices[j+1]]);
					var normal = vec3.create();
					vec3.cross(normal, vector1, vector2);
					vec3.add(normalVectors[indices[j]], normalVectors[indices[j]], normal);
					vec3.add(normalVectors[indices[j+1]], normalVectors[indices[j+1]], normal);
					vec3.add(normalVectors[indices[j+2]], normalVectors[indices[j+2]], normal);
				} 

				for (var j=0; j<normalVectors.length; j++){
					vec3.normalize(normalVectors[j], normalVectors[j]);
					normals.push(normalVectors[j][0]);
					normals.push(normalVectors[j][1]);
					normals.push(normalVectors[j][2]);
				}

				return normals;

			}

			
			// test

			var vertices = [
  // Front face
  -1.0, -1.0,  1.0,
   1.0, -1.0,  1.0,
   1.0,  1.0,  1.0,
  -1.0,  1.0,  1.0,
  
  // Back face
  -1.0, -1.0, -1.0,
  -1.0,  1.0, -1.0,
   1.0,  1.0, -1.0,
   1.0, -1.0, -1.0,
  
  // Top face
  -1.0,  1.0, -1.0,
  -1.0,  1.0,  1.0,
   1.0,  1.0,  1.0,
   1.0,  1.0, -1.0,
  
  // Bottom face
  -1.0, -1.0, -1.0,
   1.0, -1.0, -1.0,
   1.0, -1.0,  1.0,
  -1.0, -1.0,  1.0,
  
  // Right face
   1.0, -1.0, -1.0,
   1.0,  1.0, -1.0,
   1.0,  1.0,  1.0,
   1.0, -1.0,  1.0,
  
  // Left face
  -1.0, -1.0, -1.0,
  -1.0, -1.0,  1.0,
  -1.0,  1.0,  1.0,
  -1.0,  1.0, -1.0
];

var indices = [
  0,  1,  2,      0,  2,  3,    // front
  4,  5,  6,      4,  6,  7,    // back
  8,  9,  10,     8,  10, 11,   // top
  12, 13, 14,     12, 14, 15,   // bottom
  16, 17, 18,     16, 18, 19,   // right
  20, 21, 22,     20, 22, 23    // left
];

		var normals = calculateVertexNormals(vertices, indices);

		alert(normals);

		</script>

	</body>

</html>
