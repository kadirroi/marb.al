<html>

	<body>
		
		<canvas id="myCanvas" height="500" width="500">
		
		</canvas>
		Click on canvas
		<script type="text/javascript">
				
			//Step 1 : prepare the canvas and get webgl context
			var canvas = document.getElementById("myCanvas");
			canvas.addEventListener("mousedown", translate, false);
			var gl = canvas.getContext("experimental-webgl");
			if (!gl)
				alert("gl fucked up");

			//Step 2 : define the geometry and store it in buffer objects
			var vertices = [
				0.0 , 0.5, 0.0,
				-0.5, -0.5, 0.0,
				0.5, -0.5, 0.0
			];
			var vertexBuffer = gl.createBuffer();
			gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
			gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(vertices), gl.STATIC_DRAW);
			
			//Step 3 : write and compile the shader programs
			var vertCode = 'attribute vec4 coordinates;'+
			'uniform vec4 translation;'+
			'void main(void){gl_Position = coordinates + translation;}';
			var vertShader = gl.createShader(gl.VERTEX_SHADER);
			gl.shaderSource(vertShader, vertCode);
			gl.compileShader(vertShader);
			if (!gl.getShaderParameter(vertShader, gl.COMPILE_STATUS)) {
	            alert(gl.getShaderInfoLog(vertShader));
        	}

			var fragCode = "void main(void){gl_FragColor=vec4(0.0,0.0,0.0,1.0);}";
			var fragShader = gl.createShader(gl.FRAGMENT_SHADER);
			gl.shaderSource(fragShader, fragCode);
			gl.compileShader(fragShader);
			if (!gl.getShaderParameter(fragShader, gl.COMPILE_STATUS)) {
	            alert(gl.getShaderInfoLog(fragShader));
        	}

			var shaderProgram = gl.createProgram();
			gl.attachShader(shaderProgram, vertShader);
			gl.attachShader(shaderProgram, fragShader);
			gl.linkProgram(shaderProgram);
			if (!gl.getProgramParameter(shaderProgram, gl.LINK_STATUS)){
				alert("Shader fucked up");
			}
			gl.useProgram(shaderProgram);

			//Step 4: associate the shader programs to buffer objects
			gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);
			var coord = gl.getAttribLocation(shaderProgram, "coordinates");
			gl.vertexAttribPointer(coord, 3, gl.FLOAT, false, 0, 0);
			gl.enableVertexAttribArray(coord);

			
			//Step 5: drawing
			gl.clearColor(0.3, 0.3, 0.7, 1.0);
			gl.enable(gl.DEPTH_TEST); 
			gl.clear(gl.COLOR_BUFFER_BIT);
			gl.viewport(0,0,canvas.width,canvas.height);
			gl.drawArrays(gl.TRIANGLES, 0, 3);

			function translate(event){
				var tx=0.0 , ty=0.5, tz=0.0;
				var translation = gl.getUniformLocation(shaderProgram, "translation");
				gl.uniform4f(translation, tx, ty, tz, 0.0);
				gl.clearColor(0.3, 0.3, 0.7, 1.0);
				gl.enable(gl.DEPTH_TEST); 
				gl.clear(gl.COLOR_BUFFER_BIT);
				gl.viewport(0,0,canvas.width,canvas.height);
				gl.drawArrays(gl.TRIANGLES, 0, 3);
			}
		</script>

	</body>

</html>
